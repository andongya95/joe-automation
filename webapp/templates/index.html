<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEA JOE Job Postings Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>AEA JOE Job Postings Dashboard</h1>
            <nav class="main-nav">
                <a href="{{ url_for('portfolio_page') }}" class="nav-link">Portfolio Management →</a>
                <a href="{{ url_for('prompts_page') }}" class="nav-link">Prompt Settings →</a>
                <a href="{{ url_for('api_keys_page') }}" class="nav-link">API Keys →</a>
            </nav>
            <div class="stats-summary" id="statsSummary">
                <div class="stat-item">
                    <span class="stat-label">Total Jobs:</span>
                    <span class="stat-value" id="statTotal">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Pending:</span>
                    <span class="stat-value" id="statPending">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">New:</span>
                    <span class="stat-value" id="statNew">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Applied:</span>
                    <span class="stat-value" id="statApplied">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Fit Score:</span>
                    <span class="stat-value" id="statAvgScore">-</span>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="filters">
                <div class="filter-group">
                    <label for="filterStatus">Status:</label>
                    <select id="filterStatus">
                        <option value="">All (excluding unrelated)</option>
                        <option value="pending">Pending</option>
                        <option value="new">New</option>
                        <option value="applied">Applied</option>
                        <option value="expired">Expired</option>
                        <option value="rejected">Rejected</option>
                        <option value="unrelated">Unrelated</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterField">Field:</label>
                    <select id="filterField">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterPositionTrack">Position Track:</label>
                    <select id="filterPositionTrack">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterLevel">Level:</label>
                    <select id="filterLevel">
                        <option value="">All</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterCountry">Country:</label>
                    <select id="filterCountry">
                        <option value="">All Countries</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterMinScore">Min Fit Score:</label>
                    <input type="number" id="filterMinScore" min="0" max="100" step="1" placeholder="0">
                </div>
            </div>
            <div class="search-group">
                <input type="text" id="searchInput" placeholder="Search jobs...">
                <button id="clearFilters">Clear Filters</button>
                <button id="scrapeButton" class="btn-scrape">Scrape New Jobs</button>
                <label for="csvUploadInput" class="btn-upload">
                    Upload CSV Listings
                    <input type="file" id="csvUploadInput" accept=".csv">
                </label>
                <button id="processButton" class="btn-process">Process with LLM</button>
                <button id="matchButton" class="btn-process">Match Fit Scores</button>
                <label class="force-toggle">
                    <input type="checkbox" id="forceMatchToggle">
                    <span>Force full recompute</span>
                </label>
                <button id="columnSettingsBtn" class="btn-column-settings" title="Column Settings">⚙️ Columns</button>
            </div>
            <div class="bulk-actions" id="bulkActions" style="display: none;">
                <span id="selectedCount">0 selected</span>
                <button id="selectAllBtn" class="btn-select">Select All</button>
                <button id="deselectAllBtn" class="btn-select">Deselect All</button>
                <select id="bulkStatusSelect">
                    <option value="pending">Mark as Pending</option>
                    <option value="unrelated">Mark as Unrelated</option>
                    <option value="new">Mark as New</option>
                    <option value="applied">Mark as Applied</option>
                    <option value="rejected">Mark as Rejected</option>
                    <option value="expired">Mark as Expired</option>
                </select>
                <button id="bulkUpdateBtn" class="btn-bulk-update">Update Selected</button>
                <button id="processSelectedBtn" class="btn-process">Process Selected</button>
                <label class="force-toggle">
                    <input type="checkbox" id="forceProcessToggle">
                    <span>Force re-process</span>
                </label>
                <button id="matchSelectedBtn" class="btn-process">Match Selected</button>
                <label class="force-toggle">
                    <input type="checkbox" id="forceMatchSelectedToggle">
                    <span>Force recompute</span>
                </label>
            </div>
            <div class="edit-controls" id="editControls" style="display: none;">
                <button id="saveButton" class="btn-save">Save Changes</button>
                <button id="cancelEditButton" class="btn-cancel">Cancel</button>
                <span id="editStatus" class="edit-status"></span>
            </div>
        </div>

        <div class="table-wrapper">
            <div class="table-container" id="tableContainer">
                <table id="jobsTable">
                <thead>
                    <tr>
                        <th data-column="checkbox"><input type="checkbox" id="selectAllCheckbox" title="Select All"></th>
                        <th data-column="job_id">ID</th>
                        <th class="sortable" data-column="fit_score" data-sort="fit_score">Fit Score</th>
                        <th data-column="position_track">Position Track</th>
                        <th class="sortable" data-column="difficulty_score" data-sort="difficulty_score">Difficulty</th>
                        <th class="sortable" data-column="title" data-sort="title">Title</th>
                        <th class="sortable" data-column="institution" data-sort="institution">Institution</th>
                        <th data-column="field">Field</th>
                        <th data-column="level">Level</th>
                        <th class="sortable" data-column="deadline" data-sort="deadline">Deadline</th>
                        <th class="sortable" data-column="extracted_deadline" data-sort="extracted_deadline">Extracted Deadline</th>
                        <th data-column="location">Location</th>
                        <th data-column="country">Country</th>
                        <th data-column="status">Status</th>
                        <th data-column="application_materials">Application Materials</th>
                        <th data-column="references_separate_email">Refs Separate Email</th>
                        <th data-column="application_portal">Application Portal</th>
                        <th data-column="link">Link</th>
                        <th data-column="actions">Actions</th>
                    </tr>
                </thead>
                <tbody id="jobsTableBody">
                    <tr>
                        <td colspan="19" class="loading">Loading jobs...</td>
                    </tr>
                </tbody>
            </table>
            </div>
            <div class="sticky-scrollbar" id="stickyScrollbar"></div>
        </div>

        <!-- Column Settings Modal -->
        <div id="columnSettingsModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" id="closeColumnSettings">&times;</span>
                <h2>Column Settings</h2>
                <div class="column-settings-content">
                    <h3>Show/Hide Columns</h3>
                    <div id="columnVisibilityControls" class="column-visibility-controls">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    <div style="margin-top: 20px;">
                        <button id="resetColumnSettings" class="btn-reset">Reset to Default</button>
                        <button id="saveColumnSettings" class="btn-save">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="jobDetailsModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 id="modalTitle">Job Details</h2>
                <div id="modalBody"></div>
            </div>
        </div>
    </div>

    <div id="progressPanel" class="progress-panel hidden">
        <h3>Background Tasks</h3>
        <div id="progressProcess" class="progress-item hidden"></div>
        <div id="progressMatch" class="progress-item hidden"></div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

